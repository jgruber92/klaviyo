# Gruber Klaviyo Demo

When approaching this coding challenge I wanted to try and apply it to a real world problem I had that I could solve. I've always wanted to create an app around the weather and have it notify me when it was going to rain or snow and maybe even the amount of precipitation so I could plan to get the snowblower out and wake up early to clear the driveway before work or remember to pack and umbrella when it was raining. After pitching this idea to Mike Parker on the phone, it blossomed into targeting customers to buy products based on the weather in their location as a more general and applicable use case for a Klaviyo user. This was really fun to create and to be able to think through different ways to use real time dynamic data to trigger different flows.

The objective of this script is to send targeted emails to customers based off of the current weather in their location. The idea behind this is that there is a demand for specific products in industries such as outdoor stores, fashion, hardware, etc. based on the weather or season. What better time to sell to a customer than right before a snowstorm or a big rain storm when they are in need of a product such as an umbrella or a snow shovel that they may not have when they are going to need to go out in the rain or shovel out their car or front steps. We want to make sure that our customers are the first ones to reach out to ensure their customers buy these products from them.

What I've done is created a segment of all profiles that have a location associated. Using that location, the script calls an open weather API to get the current weather for each location and that creates a tracking metric called "Weather Update" and updates a property in that metric called "current_weather". I've put together a flow that is triggered via the "Weather Update" metric. Depending on the value of "current_weather" that is passed, an email, targeting the customer with a product based on their weather, is sent to them. If it's raining then the customer will receive an email to buy an umbrella, if it's snowing then they will receive and email for snow shovels, and if it's sunny out, then they will receive and email for sunglasses.

While writing this script I've tried to think through some ways this can upgraded to be used more effectively. One idea would be to send these emails a few days ahead of time since it doesn't do any good to buy an umbrella once it's already raining. The script would essentially be the same except instead of hitting the `/current` endpoint when retrieving the weather, we would hit the `/forecast` endpoint and specify how many day in the future to pull the weather forecast from. This would allow us to be able to send an email 3 days before it's going to rain to give the customer time to buy an umbrella, for example.

As a customer, I won't want to be getting these emails all the time or else I would unsubscribe pretty quickly. I've set up my flow to have a conditional split that won't send an email to someone who has already received it in the last 30 days to prevent a high unsubscribe rate.

The script would be on a schedule to run once a day at midnight `00 00 * * *` via a cron to account for any new profiles created.
